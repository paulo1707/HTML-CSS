<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DogWalker Pro - Sistema de Agendamento</title>
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="favicon_io/favicon.ico" type="image/x-icon">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-dog"></i> Patas & cia </h1>
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="nav-tab" onclick="showSection('calendar')">
                    <i class="fas fa-calendar"></i> Calendário
                </button>
                <button class="nav-tab" onclick="showSection('appointments')">
                    <i class="fas fa-clock"></i> Agendamentos
                </button>
                <button class="nav-tab" onclick="showSection('clients')">
                    <i class="fas fa-users"></i> Clientes
                </button>
                <button class="nav-tab" onclick="showSection('activities')">
                    <i class="fas fa-list-check"></i> Atividades
                </button>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="content-section active">
            <h2>Dashboard</h2>
            <div class="dashboard-grid">
                <div class="stat-card">
                    <i class="fas fa-calendar-check"></i>
                    <h3 id="todayAppointments">0</h3>
                    <p>Agendamentos Hoje</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <h3 id="totalClients">0</h3>
                    <p>Total de Clientes</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-dog"></i>
                    <h3 id="totalPets">0</h3>
                    <p>Pets Cadastrados</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-dollar-sign"></i>
                    <h3 id="monthlyRevenue">R$ 0</h3>
                    <p>Receita do Mês</p>
                </div>
            </div>

            <h3>Próximos Agendamentos</h3>
            <div id="upcomingAppointments" class="appointment-list">
                <!-- Agendamentos serão carregados aqui -->
            </div>
        </div>

        <!-- Calendar Section -->
        <div id="calendar" class="content-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Calendário</h2>
                <div>
                    <button class="btn" onclick="previousMonth()">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span id="currentMonth" style="margin: 0 20px; font-weight: 600;"></span>
                    <button class="btn" onclick="nextMonth()">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            <div id="calendarGrid" class="calendar">
                <!-- Calendário será gerado aqui -->
            </div>
        </div>

        <!-- Appointments Section -->
        <div id="appointments" class="content-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Agendamentos</h2>
                <button class="btn" onclick="openModal('appointmentModal')">
                    <i class="fas fa-plus"></i> Novo Agendamento
                </button>
            </div>
            <div id="appointmentsList" class="appointment-list">
                <!-- Agendamentos serão carregados aqui -->
            </div>
        </div>

        <!-- Clients Section -->
        <div id="clients" class="content-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Clientes</h2>
                <button class="btn" onclick="openModal('clientModal')">
                    <i class="fas fa-plus"></i> Novo Cliente
                </button>
            </div>
            <div id="clientsList" class="client-list">
                <!-- Clientes serão carregados aqui -->
            </div>
        </div>

        <!-- Activities Section -->
        <div id="activities" class="content-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Controle de Atividades</h2>
                <button class="btn" onclick="openModal('activityModal')">
                    <i class="fas fa-plus"></i> Nova Atividade
                </button>
            </div>
            <div id="activitiesList" class="appointment-list">
                <!-- Atividades serão carregadas aqui -->
            </div>
        </div>
    </div>

    <!-- Modal para Novo Agendamento -->
    <div id="appointmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Novo Agendamento</h2>
                <button class="close-modal" onclick="closeModal('appointmentModal')">&times;</button>
            </div>
            <form id="appointmentForm">
                <div class="form-group">
                    <label>Cliente</label>
                    <select id="appointmentClient" required>
                        <option value="">Selecione um cliente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Pet</label>
                    <select id="appointmentPet" required>
                        <option value="">Selecione um pet</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Data</label>
                    <input type="date" id="appointmentDate" required>
                </div>
                <div class="form-group">
                    <label>Horário</label>
                    <input type="time" id="appointmentTime" required>
                </div>
                <div class="form-group">
                    <label>Duração (minutos)</label>
                    <select id="appointmentDuration" required>
                        <option value="30">30 minutos</option>
                        <option value="60">1 hora</option>
                        <option value="90">1h 30min</option>
                        <option value="120">2 horas</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Valor (R$)</label>
                    <input type="number" id="appointmentPrice" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Observações</label>
                    <textarea id="appointmentNotes" rows="3"></textarea>
                </div>
                <button type="submit" class="btn">
                    <i class="fas fa-save"></i> Salvar Agendamento
                </button>
            </form>
        </div>
    </div>

    <!-- Modal para Novo Cliente -->
    <div id="clientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Novo Cliente</h2>
                <button class="close-modal" onclick="closeModal('clientModal')">&times;</button>
            </div>
            <form id="clientForm">
                <div class="form-group">
                    <label>Nome do Cliente</label>
                    <input type="text" id="clientName" required>
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="tel" id="clientPhone" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="clientEmail">
                </div>
                <div class="form-group">
                    <label>Endereço</label>
                    <textarea id="clientAddress" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label>Nome do Pet</label>
                    <input type="text" id="petName" required>
                </div>
                <div class="form-group">
                    <label>Raça</label>
                    <input type="text" id="petBreed" required>
                </div>
                <div class="form-group">
                    <label>Idade</label>
                    <input type="number" id="petAge" required>
                </div>
                <div class="form-group">
                    <label>Observações do Pet</label>
                    <textarea id="petNotes" rows="3"></textarea>
                </div>
                <button type="submit" class="btn">
                    <i class="fas fa-save"></i> Salvar Cliente
                </button>
            </form>
        </div>
    </div>

    <!-- Modal para Nova Atividade -->
    <div id="activityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Nova Atividade</h2>
                <button class="close-modal" onclick="closeModal('activityModal')">&times;</button>
            </div>
            <form id="activityForm">
                <div class="form-group">
                    <label>Agendamento</label>
                    <select id="activityAppointment" required>
                        <option value="">Selecione um agendamento</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="activityStatus" required>
                        <option value="iniciado">Iniciado</option>
                        <option value="em_andamento">Em Andamento</option>
                        <option value="concluido">Concluído</option>
                        <option value="cancelado">Cancelado</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Horário de Início</label>
                    <input type="datetime-local" id="activityStartTime" required>
                </div>
                <div class="form-group">
                    <label>Horário de Término</label>
                    <input type="datetime-local" id="activityEndTime">
                </div>
                <div class="form-group">
                    <label>Observações</label>
                    <textarea id="activityNotes" rows="4"></textarea>
                </div>
                <button type="submit" class="btn">
                    <i class="fas fa-save"></i> Salvar Atividade
                </button>
            </form>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        // Dados em memória
        let clients = JSON.parse(localStorage.getItem('dogwalker_clients') || '[]');
        let appointments = JSON.parse(localStorage.getItem('dogwalker_appointments') || '[]');
        let activities = JSON.parse(localStorage.getItem('dogwalker_activities') || '[]');

        let currentDate = new Date();
        let currentEditingId = null;

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
            loadCalendar();
            loadAppointments();
            loadClients();
            loadActivities();
            populateClientSelects();
            populateAppointmentSelects();
        });

        // Navegação entre seções
        function showSection(sectionId) {
            // Esconder todas as seções
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remover classe active de todas as tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar seção selecionada
            document.getElementById(sectionId).classList.add('active');
            
            // Adicionar classe active na tab clicada
            event.target.classList.add('active');
        }

        // Funções de Modal
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            // Limpar formulários
            const form = document.querySelector(`#${modalId} form`);
            if (form) form.reset();
            currentEditingId = null;
        }

        // Função de notificação
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Salvar dados no localStorage
        function saveData() {
            localStorage.setItem('dogwalker_clients', JSON.stringify(clients));
            localStorage.setItem('dogwalker_appointments', JSON.stringify(appointments));
            localStorage.setItem('dogwalker_activities', JSON.stringify(activities));
        }

        // Dashboard
        function loadDashboard() {
            const today = new Date().toDateString();
            const todayAppointments = appointments.filter(apt => 
                new Date(apt.date).toDateString() === today
            ).length;
            
            const totalClients = clients.length;
            const totalPets = clients.reduce((sum, client) => sum + client.pets.length, 0);
            
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const monthlyRevenue = appointments
                .filter(apt => {
                    const aptDate = new Date(apt.date);
                    return aptDate.getMonth() === currentMonth && 
                           aptDate.getFullYear() === currentYear;
                })
                .reduce((sum, apt) => sum + parseFloat(apt.price || 0), 0);

            document.getElementById('todayAppointments').textContent = todayAppointments;
            document.getElementById('totalClients').textContent = totalClients;
            document.getElementById('totalPets').textContent = totalPets;
            document.getElementById('monthlyRevenue').textContent = `R$ ${monthlyRevenue.toFixed(2)}`;

            // Carregar próximos agendamentos
            const upcoming = appointments
                .filter(apt => new Date(apt.date + ' ' + apt.time) >= new Date())
                .sort((a, b) => new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time))
                .slice(0, 5);

            const upcomingContainer = document.getElementById('upcomingAppointments');
            upcomingContainer.innerHTML = upcoming.map(apt => {
                const client = clients.find(c => c.id === apt.clientId);
                const pet = client?.pets.find(p => p.id === apt.petId);
                return `
                    <div class="appointment-card">
                        <div class="appointment-header">
                            <div>
                                <strong>${client?.name || 'Cliente não encontrado'}</strong>
                                <p>Pet: ${pet?.name || 'Pet não encontrado'}</p>
                            </div>
                            <div class="appointment-time">
                                ${formatDate(apt.date)} - ${apt.time}
                            </div>
                        </div>
                        <p><strong>Duração:</strong> ${apt.duration} minutos</p>
                        <p><strong>Valor:</strong> R$ ${parseFloat(apt.price).toFixed(2)}</p>
                        ${apt.notes ? `<p><strong>Obs:</strong> ${apt.notes}</p>` : ''}
                    </div>
                `;
            }).join('');
        }

        // Calendário
        function loadCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('currentMonth').textContent = 
                new Date(year, month).toLocaleDateString('pt-BR', { 
                    month: 'long', 
                    year: 'numeric' 
                });

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';

            // Cabeçalhos dos dias da semana
            const dayHeaders = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = day;
                calendarGrid.appendChild(header);
            });

            // Dias vazios no início
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendarGrid.appendChild(emptyDay);
            }

            // Dias do mês
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.innerHTML = `<strong>${day}</strong>`;
                
                const dayDate = new Date(year, month, day).toISOString().split('T')[0];
                const dayAppointments = appointments.filter(apt => apt.date === dayDate);
                
                if (dayAppointments.length > 0) {
                    dayElement.classList.add('has-appointment');
                    dayElement.innerHTML += '<div class="appointment-dot"></div>';
                    dayElement.innerHTML += `<small>${dayAppointments.length} agendamento(s)</small>`;
                }
                
                dayElement.onclick = () => showDayAppointments(dayDate);
                calendarGrid.appendChild(dayElement);
            }
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            loadCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            loadCalendar();
        }

        function showDayAppointments(date) {
            const dayAppointments = appointments.filter(apt => apt.date === date);
            if (dayAppointments.length > 0) {
                showSection('appointments');
                // Destacar agendamentos do dia
                setTimeout(() => {
                    document.querySelectorAll('.appointment-card').forEach(card => {
                        card.style.border = '2px solid #e2e8f0';
                    });
                    dayAppointments.forEach(apt => {
                        const card = document.querySelector(`[data-appointment-id="${apt.id}"]`);
                        if (card) {
                            card.style.border = '2px solid #667eea';
                            card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    });
                }, 100);
            }
        }

        // Agendamentos
        function loadAppointments() {
            const appointmentsList = document.getElementById('appointmentsList');
            const sortedAppointments = appointments
                .sort((a, b) => new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time));

            appointmentsList.innerHTML = sortedAppointments.map(apt => {
                const client = clients.find(c => c.id === apt.clientId);
                const pet = client?.pets.find(p => p.id === apt.petId);
                const activity = activities.find(act => act.appointmentId === apt.id);
                
                return `
                    <div class="appointment-card" data-appointment-id="${apt.id}">
                        <div class="appointment-header">
                            <div>
                                <strong>${client?.name || 'Cliente não encontrado'}</strong>
                                <p>Pet: ${pet?.name || 'Pet não encontrado'} (${pet?.breed || 'N/A'})</p>
                                ${activity ? `<span style="background: ${getStatusColor(activity.status)}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px;">${activity.status.replace('_', ' ').toUpperCase()}</span>` : ''}
                            </div>
                            <div>
                                <div class="appointment-time">
                                    ${formatDate(apt.date)} - ${apt.time}
                                </div>
                                <div style="margin-top: 10px;">
                                    <button class="btn" onclick="editAppointment('${apt.id}')" style="padding: 5px 10px; font-size: 12px;">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-danger" onclick="deleteAppointment('${apt.id}')" style="padding: 5px 10px; font-size: 12px; margin-left: 5px;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <p><strong>Duração:</strong> ${apt.duration} minutos</p>
                        <p><strong>Valor:</strong> R$ ${parseFloat(apt.price).toFixed(2)}</p>
                        <p><strong>Endereço:</strong> ${client?.address || 'N/A'}</p>
                        ${apt.notes ? `<p><strong>Observações:</strong> ${apt.notes}</p>` : ''}
                    </div>
                `;
            }).join('');
        }

        function getStatusColor(status) {
            const colors = {
                'iniciado': '#3182ce',
                'em_andamento': '#d69e2e',
                'concluido': '#38a169',
                'cancelado': '#e53e3e'
            };
            return colors[status] || '#718096';
        }

        // Clientes
        function loadClients() {
            const clientsList = document.getElementById('clientsList');
            clientsList.innerHTML = clients.map(client => `
                <div class="client-card">
                    <div class="client-header">
                        <div class="client-name">${client.name}</div>
                        <div>
                            <button class="btn" onclick="editClient('${client.id}')" style="padding: 5px 10px; font-size: 12px;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger" onclick="deleteClient('${client.id}')" style="padding: 5px 10px; font-size: 12px; margin-left: 5px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <p><i class="fas fa-phone"></i> ${client.phone}</p>
                    ${client.email ? `<p><i class="fas fa-envelope"></i> ${client.email}</p>` : ''}
                    <p><i class="fas fa-map-marker-alt"></i> ${client.address}</p>
                    
                    ${client.pets.map(pet => `
                        <div class="pet-info">
                            <strong><i class="fas fa-dog"></i> ${pet.name}</strong>
                            <p>Raça: ${pet.breed} | Idade: ${pet.age} anos</p>
                            ${pet.notes ? `<p>Obs: ${pet.notes}</p>` : ''}
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }

        // Atividades
        function loadActivities() {
            const activitiesList = document.getElementById('activitiesList');
            const sortedActivities = activities
                .sort((a, b) => new Date(b.startTime) - new Date(a.startTime));

            activitiesList.innerHTML = sortedActivities.map(activity => {
                const appointment = appointments.find(apt => apt.id === activity.appointmentId);
                const client = clients.find(c => c.id === appointment?.clientId);
                const pet = client?.pets.find(p => p.id === appointment?.petId);
                
                return `
                    <div class="appointment-card">
                        <div class="appointment-header">
                            <div>
                                <strong>${client?.name || 'Cliente não encontrado'}</strong>
                                <p>Pet: ${pet?.name || 'Pet não encontrado'}</p>
                                <span style="background: ${getStatusColor(activity.status)}; color: white; padding: 4px 12px; border-radius: 15px; font-size: 14px;">
                                    ${activity.status.replace('_', ' ').toUpperCase()}
                                </span>
                            </div>
                            <div>
                                <button class="btn" onclick="editActivity('${activity.id}')" style="padding: 5px 10px; font-size: 12px;">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger" onclick="deleteActivity('${activity.id}')" style="padding: 5px 10px; font-size: 12px; margin-left: 5px;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <p><strong>Início:</strong> ${formatDateTime(activity.startTime)}</p>
                        ${activity.endTime ? `<p><strong>Término:</strong> ${formatDateTime(activity.endTime)}</p>` : ''}
                        ${activity.notes ? `<p><strong>Observações:</strong> ${activity.notes}</p>` : ''}
                    </div>
                `;
            }).join('');
        }

        // Formulários
        document.getElementById('clientForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const clientData = {
                id: currentEditingId || generateId(),
                name: document.getElementById('clientName').value,
                phone: document.getElementById('clientPhone').value,
                email: document.getElementById('clientEmail').value,
                address: document.getElementById('clientAddress').value,
                pets: [{
                    id: generateId(),
                    name: document.getElementById('petName').value,
                    breed: document.getElementById('petBreed').value,
                    age: parseInt(document.getElementById('petAge').value),
                    notes: document.getElementById('petNotes').value
                }]
            };

            if (currentEditingId) {
                const index = clients.findIndex(c => c.id === currentEditingId);
                if (index !== -1) {
                    // Manter pets existentes se estiver editando
                    clientData.pets = clients[index].pets;
                    clients[index] = clientData;
                }
            } else {
                clients.push(clientData);
            }

            saveData();
            loadClients();
            loadDashboard();
            populateClientSelects();
            closeModal('clientModal');
            showNotification(currentEditingId ? 'Cliente atualizado!' : 'Cliente cadastrado!');
        });

        document.getElementById('appointmentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const appointmentData = {
                id: currentEditingId || generateId(),
                clientId: document.getElementById('appointmentClient').value,
                petId: document.getElementById('appointmentPet').value,
                date: document.getElementById('appointmentDate').value,
                time: document.getElementById('appointmentTime').value,
                duration: parseInt(document.getElementById('appointmentDuration').value),
                price: parseFloat(document.getElementById('appointmentPrice').value),
                notes: document.getElementById('appointmentNotes').value
            };

            if (currentEditingId) {
                const index = appointments.findIndex(a => a.id === currentEditingId);
                if (index !== -1) {
                    appointments[index] = appointmentData;
                }
            } else {
                appointments.push(appointmentData);
            }

            saveData();
            loadAppointments();
            loadDashboard();
            loadCalendar();
            populateAppointmentSelects();
            closeModal('appointmentModal');
            showNotification(currentEditingId ? 'Agendamento atualizado!' : 'Agendamento criado!');
        });

        document.getElementById('activityForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const activityData = {
                id: currentEditingId || generateId(),
                appointmentId: document.getElementById('activityAppointment').value,
                status: document.getElementById('activityStatus').value,
                startTime: document.getElementById('activityStartTime').value,
                endTime: document.getElementById('activityEndTime').value,
                notes: document.getElementById('activityNotes').value
            };

            if (currentEditingId) {
                const index = activities.findIndex(a => a.id === currentEditingId);
                if (index !== -1) {
                    activities[index] = activityData;
                }
            } else {
                activities.push(activityData);
            }

            saveData();
            loadActivities();
            loadAppointments();
            closeModal('activityModal');
            showNotification(currentEditingId ? 'Atividade atualizada!' : 'Atividade criada!');
        });

        // Funções de edição e exclusão
        function editClient(clientId) {
            const client = clients.find(c => c.id === clientId);
            if (client) {
                currentEditingId = clientId;
                document.getElementById('clientName').value = client.name;
                document.getElementById('clientPhone').value = client.phone;
                document.getElementById('clientEmail').value = client.email || '';
                document.getElementById('clientAddress').value = client.address;
                
                if (client.pets.length > 0) {
                    const pet = client.pets[0];
                    document.getElementById('petName').value = pet.name;
                    document.getElementById('petBreed').value = pet.breed;
                    document.getElementById('petAge').value = pet.age;
                    document.getElementById('petNotes').value = pet.notes || '';
                }
                
                openModal('clientModal');
            }
        }

        function deleteClient(clientId) {
            if (confirm('Tem certeza que deseja excluir este cliente? Todos os agendamentos relacionados também serão excluídos.')) {
                clients = clients.filter(c => c.id !== clientId);
                appointments = appointments.filter(a => a.clientId !== clientId);
                activities = activities.filter(act => {
                    const appointment = appointments.find(apt => apt.id === act.appointmentId);
                    return appointment && appointment.clientId !== clientId;
                });
                
                saveData();
                loadClients();
                loadAppointments();
                loadActivities();
                loadDashboard();
                loadCalendar();
                populateClientSelects();
                populateAppointmentSelects();
                showNotification('Cliente excluído!');
            }
        }

        function editAppointment(appointmentId) {
            const appointment = appointments.find(a => a.id === appointmentId);
            if (appointment) {
                currentEditingId = appointmentId;
                document.getElementById('appointmentClient').value = appointment.clientId;
                populatePetSelect(appointment.clientId);
                document.getElementById('appointmentPet').value = appointment.petId;
                document.getElementById('appointmentDate').value = appointment.date;
                document.getElementById('appointmentTime').value = appointment.time;
                document.getElementById('appointmentDuration').value = appointment.duration;
                document.getElementById('appointmentPrice').value = appointment.price;
                document.getElementById('appointmentNotes').value = appointment.notes || '';
                
                openModal('appointmentModal');
            }
        }

        function deleteAppointment(appointmentId) {
            if (confirm('Tem certeza que deseja excluir este agendamento?')) {
                appointments = appointments.filter(a => a.id !== appointmentId);
                activities = activities.filter(act => act.appointmentId !== appointmentId);
                
                saveData();
                loadAppointments();
                loadActivities();
                loadDashboard();
                loadCalendar();
                populateAppointmentSelects();
                showNotification('Agendamento excluído!');
            }
        }

        function editActivity(activityId) {
            const activity = activities.find(a => a.id === activityId);
            if (activity) {
                currentEditingId = activityId;
                document.getElementById('activityAppointment').value = activity.appointmentId;
                document.getElementById('activityStatus').value = activity.status;
                document.getElementById('activityStartTime').value = activity.startTime;
                document.getElementById('activityEndTime').value = activity.endTime || '';
                document.getElementById('activityNotes').value = activity.notes || '';
                
                openModal('activityModal');
            }
        }

        function deleteActivity(activityId) {
            if (confirm('Tem certeza que deseja excluir esta atividade?')) {
                activities = activities.filter(a => a.id !== activityId);
                
                saveData();
                loadActivities();
                loadAppointments();
                showNotification('Atividade excluída!');
            }
        }

        // Funções auxiliares
        function populateClientSelects() {
            const clientSelect = document.getElementById('appointmentClient');
            clientSelect.innerHTML = '<option value="">Selecione um cliente</option>';
            
            clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.id;
                option.textContent = client.name;
                clientSelect.appendChild(option);
            });
        }

        function populatePetSelect(clientId) {
            const petSelect = document.getElementById('appointmentPet');
            petSelect.innerHTML = '<option value="">Selecione um pet</option>';
            
            const client = clients.find(c => c.id === clientId);
            if (client) {
                client.pets.forEach(pet => {
                    const option = document.createElement('option');
                    option.value = pet.id;
                    option.textContent = `${pet.name} (${pet.breed})`;
                    petSelect.appendChild(option);
                });
            }
        }

        function populateAppointmentSelects() {
            const appointmentSelect = document.getElementById('activityAppointment');
            appointmentSelect.innerHTML = '<option value="">Selecione um agendamento</option>';
            
            appointments.forEach(appointment => {
                const client = clients.find(c => c.id === appointment.clientId);
                const pet = client?.pets.find(p => p.id === appointment.petId);
                
                if (client && pet) {
                    const option = document.createElement('option');
                    option.value = appointment.id;
                    option.textContent = `${client.name} - ${pet.name} (${formatDate(appointment.date)} ${appointment.time})`;
                    appointmentSelect.appendChild(option);
                }
            });
        }

        // Event listeners
        document.getElementById('appointmentClient').addEventListener('change', function() {
            populatePetSelect(this.value);
        });

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('pt-BR');
        }

        function formatDateTime(dateTimeString) {
            return new Date(dateTimeString).toLocaleString('pt-BR');
        }

        // Fechar modal clicando fora
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
